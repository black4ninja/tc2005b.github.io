<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Laboratorio 12: Criterios de consulta en aplicaciones cliente</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<style type="text/css">
<!--
.Code { font-family:"Courier New", Courier, monospace; font-size:12px; color:#003366; background-color:#FFFFCC}
.Estilo1 {font-family: Arial, Helvetica, sans-serif}
.Estilo4 {font-family: Arial, Helvetica, sans-serif; color: #000000; }
.Estilo3 {font-family: Arial, Helvetica, sans-serif; font-size: 9px; }
body {
	margin-top: 0px;
	margin-bottom: 0px;
}
.Estilo5 {font-size: 14px}
.Estilo6 {font-family: Arial, Helvetica, sans-serif; font-size: 14px; }
.style1 {
	text-align: center;
}
.style2 {
	text-decoration: underline;
}
-->
</style>
</head>

<body>
<table width="98%" border="0">
  <tr>
    <td><div align="right"><img src="../imagenes/actividades.jpg" width="600" height="50"></div></td>
  </tr>
  <tr>
    <td><p align="left" class="Estilo4"><strong>Laboratorio 12: Criterios de consulta en aplicaciones              cliente<br>
</strong><strong><br>
</strong></p>
    </td></tr>
  <tr>
    <td class="Estilo1 Estilo5"><p class="Estilo6"><strong><img src="../imagenes/objetivos.jpg" width="600" height="50"></strong></p>
      <p class="Estilo6"><br>
		El objetivo de esta práctica, es crear una aplicación que&nbsp;                  permita a un usuario final realizar <strong>consultas de manera din&aacute;mica</strong>,                  sin que se vea en la necesidad de saber SQL, es decir, definiremos un interfaz                  entre el usuario y el DBMS para que el realice consultas f&aacute;cilmente.<br>
        <br>
      <img src="../imagenes/instrucciones.jpg" width="600" height="50"></p>
      <p class="Estilo6"><strong> </strong><font color="#000000"><img height="13" width="13"
 alt="" src="../imagenes/TgC_boton30.gif"> </font><b>Criterios de consulta</b><br>
        <br>
Para realizar una interfaz de consulta a la base de datos en la que el usuario
                indique los criterios que deben cumplir los datos que desea consultar, requerimos
      crear formas que cuenten con los siguientes elementos: </p>
      <blockquote><img src="../imagenes/ball.gif" alt="" height="8" width="8"> Elementos de la interfaz que permitan al usuario indicar los criterios (TextBoxes,
        ListBoxes, CheckBoxes, Option Buttons etc.)<br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> Construcci&oacute;n de la sentencia de consulta que considere los criterios
        indicados.<br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> Env&iacute;o de la consulta al servidor y recuperaci&oacute;n de los resultados
        de la consulta <br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> Elementos de la interfaz para mostrar los resultados.</blockquote>
      <font color="#000000"><img height="13" width="13"
 alt="" src="../imagenes/TgC_boton30.gif"> &nbsp;</font><font color="#3366ff"
 face="Courier New, Courier, monospace"><b> </b></font><b>Desarrollemos
    estos elementos con un ejemplo:</b><br>
    <br>
    <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
	Crea un nuevo proyecto de C# y agrega la biblioteca <strong>Util.cs</strong> 
	que desarrollaste el laboratorio pasado. Recuerda realizar el ajuste al
	<strong>NameSpace</strong> correcto.<br>
                <br>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>En 
	la forma por omisión,&nbsp; agrega un TextBox con su correspondiente Label
                para cada uno de los siguientes datos:<br>
                <br>
                <blockquote><img src="../imagenes/ball.gif" alt="" height="8" width="8"> Descripci&oacute;n del material<br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> Raz&oacute;n social del proveedor<br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> Denominaci&oacute;n del proyecto </blockquote>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>Agrega a la forma dos controles de la clase <b>DateTimePicker</b> uno
                para la fecha inicial y otro para la fecha final.<br>
                <br>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>Agrega tres RadioButton y etiqu&eacute;talos como:<br>
                <blockquote><img src="../imagenes/ball.gif" alt="" height="8" width="8"> cantidad menor a 300<br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> cantidad de 300 a 500<br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> cantidad mayor a 500.</blockquote>
                <p><font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
				Agrega dos botones, uno etiquetado como Buscar y otro como 
				Limpiar,&nbsp; y un <b>DataGridView</b> para mostrar los resultados. 
				Recuerda asignarle nombre a los controles conforme a las 
				convenciones descritas en la sesión de clase. La apariencia de 
				la ventana podría ser la siguiente:</p>
                <p class="style1"><img src="lab12/lab12a.jpg"><br>
	</p>
	<p>
                    <br>
                    <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>En el m&oacute;dulo <b>modUtil</b> agrega la siguiente
                  funci&oacute;n que nos facilitar&aacute; la conversi&oacute;n de tipos de
                  datos: </p>
                <pre class="Code">    '---------------------------------------------------------------------------------------------------------'
    '  Cambia el formato del objeto pasado como par&aacute;metro a un formato que entiende SQL Server                '
    '                                                                                                         '
    '  @param  param  El objeto que se quiere convertir a formato de SQL Server                               '
    '  @return  Un String que representa al objeto con un formato comprensible por SQL Server                 '
    '---------------------------------------------------------------------------------------------------------'
 public static String sqlFormat(Object param)
    {
       // En caso de ser un alfanumerico
 
       if (param is String)
        {
            String sParam;
            sParam = param.ToString();
            return ("'" + sParam.Replace("'", "\'") + "'");
        }
       else if (param is DateTime)
       {
           return "'" + ((DateTime)param).ToString("d/MM/yyyy HH:mm:ss") + "'"; 
       }
       else if (param == null)
       {
           return "null";
       }
       else
           try
           {
               return param.ToString();
           }
           catch (Exception ex)
           {
               String err;
               err = "Error al ejecutar <sqlFormat>"
               + Environment.NewLine + ex.Message;
               msgError(err);
               return "null";
           }
   }
                </pre>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>Agrega a la forma la llamada correspondiente
                al método <b>CreateConnection</b> en el evento Load de la forma.<br>
                <br>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
	En el evento <b>Click </b>del bot&oacute;n <b>Buscar</b>,
                debemos agregar el c&oacute;digo para <b>armar</b> la consulta con base en los
                criterios seleccionados por el usuario y una vez armada la consulta efect&uacute;e
                la llamada correspondiente a <b>fillGrid </b>para mostrar los resultados,
                considerando lo siguiente:<br>
                <br>
                <blockquote><img src="../imagenes/ball.gif" alt="" height="8" width="8"> El criterio indicado en los <b>TextBox </b>debe ser interpretado como <b>patrones </b>para el operador 
					<strong>like</strong> de SQL. Si se dejan vac&iacute;os,
                  indican no restringir (incluir todos). <br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> El criterio indicado en los <strong>DateTimePicker</strong> debe ser considerado como los
                  extremos de un <b>BETWEEN. </b>(intervalo entre fechas)<br>
                    <img src="../imagenes/ball.gif" alt="" height="8" width="8"> Los criterios de los RadioButton deben traducirse como las <b>condiciones </b>correspondientes.<br>
                </blockquote>
                <font color="#000000"><img height="13" width="13"
 alt="" src="../imagenes/TgC_boton30.gif"> </font><b> Procedimiento</b><br>
                <br>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
	El primer paso es definir en una variable la <strong>consulta general</strong>,como 
	te habrás dado cuenta, consiste en mostrar TODOS los campos que han sido 
	propuestos en la interfaz. Entonces en el grid mostraríamos descripcion, 
	razon social , denominación , fecha y cantidad de los materiales entregados.<br>
                <br>
Declara una variable de tipo string en la que armar&aacute;s la consulta.
<pre class="Code">
String query;
</pre>
	Identifica qu&eacute; partes de la consulta son<b> constantes </b>y que partes <b>variar&aacute;n</b> de acuerdo a los criterios indicados.<br>
<br>
<font color="#993399"><b>Tip:</b></font> las cl&aacute;usulas <b>SELECT, FROM y WHERE</b> con las condiciones de <b>Join no
                  var&iacute;an</b>, s&oacute;lo el resto de las condiciones (las de selecci&oacute;n)
                ser&aacute;n determinadas por lo que indique el usuario en la interfaz.
                Esta ultima parte se explica posteriormente.<pre class="Code">

query = "SELECT ... FROM ... WHERE ..."
                </pre>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
	En este punto prueba tu aplicación, si oprimes el botón de <strong>Buscar</strong> 
	debe mostrar en el <strong>grid</strong> los datos antes descritos de las
	<strong>entregas realizadas</strong>, esto aún sin restricción alguna.<br>
	<br>
	<div class="style1">
	<pre>
	<img src="lab12/lab12b.jpg"><br>
</pre>
	</div>
	<font color="#3366ff" face="Courier New, Courier, monospace"><b>
	<img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
	Ahora debes incluir las restricción a la búsqueda, para ello utilizarás sentencias <b>If</b> para determinar si el usuario
                llen&oacute; determinados controles, y partir de ello incluirlos 
	en el criterio de la consulta. A continuación se da más detalle:<br>
	<br>
                <br>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>Utiliza la funci&oacute;n <b>sqlFormat</b> para convertir
                los valores de los TextBox agregando los comodines <b>"%"</b> antes de hacer
                la conversi&oacute;n. Por ejemplo, para el criterio de la descripci&oacute;n
                del material:<pre class="Code">      
        if (txtDescripcion.Text != "")
             query +=" AND Descripcion LIKE " + 
	    Util.sqlFormat( "%" + txtDescripcion.Text + "%");     
	               </pre>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>Utiliza la funci&oacute;n <b>sqlFormat</b> para convertir
                los valores de los DTPicker. Suponiendo que se llaman dtpDesde y 
	dtpHasta,
                podr&iacute;a manejarse como:<br>
                <pre class="Code">	if (dtpDesde.Value < dtpHasta.Value)
		query += " AND Fecha BETWEEN " + 
	         sqlFormat(dtpDesde.Value) + " AND " + sqlFormat(dtpHasta.Value);
		                </pre>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b>
	<br>
	<img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>En el caso de los RadioButton, utiliza la propiedad Value
                para determinar cu&aacute;l fue seleccionado:<br>
                <pre class="Code">        if (RadioButton.Checked)
            query = query + " AND Cantidad < 300";
		 </pre>
                <font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
	<span class="style2"><strong>Prueba</strong> la aplicación</span> llenando las diferentes combinaciones de
                criterios y asegur&aacute;ndote de que los resultados coinciden con lo solicitado.<br>
	<br>
	<br>
&nbsp;<font color="#3366ff" face="Courier New, Courier, monospace"><b><img src="../imagenes/vi_rombo.gif" alt="" height="14" width="14"> </b></font>
	Por ultimo implementa el botón de limpiar, recuerda que ya existe un método 
	en la biblioteca para hacerlo.<p class="Estilo6"><img src="../imagenes/especificaciones.jpg" width="600" height="50"></p>
      <p class="Estilo6"><strong>La calificaci&oacute;n de esta actividad     es de 
		carácter individual.<br>
          <br>
Env&iacute;a el laboratorio por este medio , archivo lab12 +  matricula.zip.</strong></p>
	</td>
  </tr>
  </table>

<map name="Map"><area shape="rect" coords="5,6,103,123" href="../../semana7/lab11/proveedores.csv">
<area shape="rect" coords="130,7,229,123" href="../../semana7/lab11/proyectos.csv">
<area shape="rect" coords="255,7,352,122" href="../../semana7/lab11/entregan.csv">
<area shape="rect" coords="373,5,474,122" href="../../semana7/lab11/materiales.csv">
</map></body>
</html>
